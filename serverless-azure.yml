service: sls-movie-api

configValidationMode: off

provider:
  name: azure
  resourceGroup: sls-movie-api
  location: ${env:AZURE_LOCATION}
  runtime: nodejs14
  apim:
    apis:
      - name: movies
        displayName: GraphQL Movie API
        description: The GraphQL Movie API
        protocols:
          - https
        path: movies
        # tags:
        #   - tag1
        #   - tag2
        subscriptionRequired: false
        authorization: none
    backends:
      - name: movie-backend
        url: graphql

functions:
  graphql:
    handler: src/apollo-server.graphqlHandler
    apim:
      api: movies
      backend: movie-backend
      operations:
        - method: post
          urlTemplate: /
          displayName: GraphQL
    events:
      - http:
          path: graphql
          method: POST
        authLevel: anonymous
      - http: true
        x-azure-settings:
          direction: out
          name: $return

plugins:
  - serverless-azure-functions
  - serverless-webpack

custom:
  webpack:
    includeModules: true
